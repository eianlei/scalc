<!DOCTYPE html>
<link rel="stylesheet" href="index.css">



<h1>Gas Blender</h1>
<p>Current tank mix</p>
<table class="t2">
    <tr>
        <td>Current tank pressure (bar)</td>
        <td><input type="number" min=1 max=300 step=1 class="input2" value="100" id="start_bar"/></td>
    </tr>
    <tr>
        <td>Current Oxygen (%)</td>
        <td><input type="number" min=10 max=100 step=1 class="input2" value="21" id="start_o2_pct"/></td>
    </tr>
    <tr>
        <td>Current Helium (%)</td>
        <td><input type="number" min=0 max=100 step=1 class="input2" value="35" id="start_he_pct"/></td>
    </tr>
</table>
<p>Wanted tank mix</p>
<table class="t2">
    <tr>
        <td>Wanted tank pressure (bar)</td>
        <td><input type="number" min=1 max=300 step=1 class="input2" value="200" id="end_bar"/></td>
    </tr>
    <tr>
        <td>Wanted Oxygen (%)</td>
        <td><input type="number" min=10 max=100 step=1 class="input2" value="21" id="end_o2_pct"/></td>
    </tr>
    <tr>
        <td>Wanted Helium (%)</td>
        <td><input type="number" min=0 max=100 step=1 class="input2" value="35" id="end_he_pct"/></td>
    </tr>
    <tr>
        <td>Blending methods</td>
        <td>
          <select id ="ddl_ft" name="ddl_ft" class="ddl" onmousedown="this.value='';"" value="air">
            <option value='air'>plain air fill</option>
            <option value='nx'>Nitrox CFM</option>
            <option value='tmx'>Trimix CFM</option>
            <option value='pp'>Partial Pressure</option>
            <option value='cfm'>Helium + Nitrox CFM</option>
          </select>
        </td>
      </tr>
</table>
<textarea id="text_output" name="text_output" cols="60" rows="10" >
this is where the calculation output prints
</textarea>

<!--
<script src="../node_modules/jquery/dist/jquery.min.js" type="text/javascript"></script>
-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="./tmxcalc.js"></script>
<script>
    var filltype = "pp";
    function calculateBlend()
    {
        start_bar =    parseInt($("#start_bar").val());
        end_bar =      parseInt($('#end_bar').val());
        start_o2_pct = parseInt($('#start_o2_pct').val());
        start_he_pct = parseInt($('#start_he_pct').val());
        end_o2_pct =   parseInt($('#end_o2_pct').val());
        end_he_pct =   parseInt($('#end_he_pct').val());
        // filltype = "pp";
        // filltype = $("#ddl_ft").val;
   
        deb_txt =  `calculateBlend ${start_bar} ${end_bar} ${start_o2_pct} ${start_he_pct} ${end_o2_pct} ${end_he_pct}`;
        console.log(filltype);
        // $("#text_output").val(deb_txt);
        result = tmxcalc_num(filltype, start_bar, start_o2_pct, start_he_pct, 
                end_bar, end_o2_pct, end_he_pct, false, false);

        if (result.status_code == 0) {
           result_txt = tmxcalc_text(filltype, start_bar, start_o2_pct, start_he_pct,
                result.mix_o2_pct, result.mix_he_pct, result.mix_n_pct,
                result.add_o2, result.add_he, result.add_air,
                result.tbar_3, 
                end_bar
            )
           $("#text_output").val(result_txt);
        }
        else {
            $("#text_output").val(result.status_txt);
        }

    }

  // this is called when any class input2 element changes
  $(function()
  {
      $(".input2").on("change",calculateBlend)
  })

  $("#ddl_ft").change(function () {

   dropval = $(this).val()
   console.log(`ddl_ft ${dropval} `);
   filltype = dropval;

   calculateBlend();
  });

</script>