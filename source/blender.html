<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="index.css">
<style>
    /* (A1) FLEXIBLE CONTAINER */
    .wrap-flex {
      display: flex;
      width: 100%;
      /* OPTIONAL ALIGNMENT: flex-start | flex-end | center | baseline | stretch */
      align-items: baseline;
    }
     
    /* (A2) NOT IMPORTANT, JUST TO BETTER SHOW HOW ALIGN-ITEMS WORK 
    .wrap-flex > * {
      border: 1px solid red;
      width: 33%; 
    } */
</style>


<h1>Gas Blender</h1>
<p>calculate gas blending</p>
<table class="t2">
    <tr>
        <td><b>Current tank mix</b></td>
        <td>
            <select id ="dd_startGas" name="dd_wantedGas" class="ddl" onmousedown="this.value='';"" >
                <option value='21/0'>air</option>
                <option value='28/0'>EAN 28%</option>
                <option value='32/0'>EAN 32%</option>
                <option value='30/30'>TMX 30/30</option>
                <option value='21/35' selected="selected">TMX 21/35</option>
                <option value='18/45'>TMX 18/45</option>
                <option value='15/55'>TMX 15/55</option> 
                <option value='12/65'>TMX 12/65</option>
                <option value='10/70'>TMX 10/70</option> 
                <option value='50/0'>EAN 50%</option>
                <option value='100/0'>EAN 100%</option>
              </select>          
        </td>
    </tr>
    <tr>
        <td>Current tank pressure (bar)</td>
        <td><input type="number" min=1 max=300 step=1 class="input2" value="100" id="start_bar"/></td>
        <td><button>EMPTY</button></td>
    </tr>
    <tr>
        <td>Current Oxygen (%)</td>
        <td><input type="number" min=10 max=100 step=1 class="input2" value="21" id="start_o2_pct"/></td>
    </tr>
    <tr>
        <td>Current Helium (%)</td>
        <td><input type="number" min=0 max=100 step=1 class="input2" value="35" id="start_he_pct"/></td>
    </tr>
</table>
<hr>
<table class="t2">
    <tr>
        <td><b>Wanted tank mix</b></td>
        <td>
            <select id ="dd_wantedGas" name="dd_wantedGas" class="ddl" onmousedown="this.value='';"" >
                <option value='21/0'>air</option>
                <option value='28/0'>EAN 28%</option>
                <option value='32/0'>EAN 32%</option>
                <option value='30/30'>TMX 30/30</option>
                <option value='21/35' selected="selected">TMX 21/35</option>
                <option value='18/45'>TMX 18/45</option>
                <option value='15/55'>TMX 15/55</option> 
                <option value='12/65'>TMX 12/65</option>
                <option value='10/70'>TMX 10/70</option> 
                <option value='50/0'>EAN 50%</option>
                <option value='100/0'>EAN 100%</option>
              </select>          
        </td>
    </tr>
    <tr>
        <td>Wanted tank pressure (bar)</td>
        <td><input type="number" min=1 max=300 step=1 class="input2" value="200" id="end_bar"/></td>
        <td>
            <select id ="dd_startGas" name="dd_wantedGas" class="ddl" onmousedown="this.value='';"" >
                <option value='200' selected="selected">200</option>
                <option value='232'>232</option>
                <option value='300'>300</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>Wanted Oxygen (%)</td>
        <td><input type="number" min=10 max=100 step=1 class="input2" value="21" id="end_o2_pct"/></td>
    </tr>
    <tr>
        <td>Wanted Helium (%)</td>
        <td><input type="number" min=0 max=100 step=1 class="input2" value="35" id="end_he_pct"/></td>
    </tr>
</table>
<div class="wrap-flex">
    <p><b>Blending method selection: </b></p>

    <select id ="ddl_ft" name="ddl_ft" class="ddl" onmousedown="this.value='';"" value="air">
    <option value='air'>plain air fill</option>
    <option value='nx'>Nitrox CFM</option>
    <option value='tmx'>Trimix CFM</option>
    <option value='pp'>Partial Pressure</option>
    <option value='cfm'>Helium + Nitrox CFM</option>
    </select>
</div>

<textarea id="text_output" name="text_output" cols="60" rows="10" >
this is where the calculation output prints
</textarea>

<!--
<script src="../node_modules/jquery/dist/jquery.min.js" type="text/javascript"></script>
-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="./tmxcalc.js"></script>
<script>
    var filltype = "pp";
    function calculateBlend()
    {
        start_bar =    parseInt($("#start_bar").val());
        end_bar =      parseInt($('#end_bar').val());
        start_o2_pct = parseInt($('#start_o2_pct').val());
        start_he_pct = parseInt($('#start_he_pct').val());
        end_o2_pct =   parseInt($('#end_o2_pct').val());
        end_he_pct =   parseInt($('#end_he_pct').val());
        // filltype = "pp";
        // filltype = $("#ddl_ft").val;
   
        deb_txt =  `calculateBlend ${start_bar} ${end_bar} ${start_o2_pct} ${start_he_pct} ${end_o2_pct} ${end_he_pct}`;
        console.log(filltype);
        // $("#text_output").val(deb_txt);
        result = tmxcalc_num(filltype, start_bar, start_o2_pct, start_he_pct, 
                end_bar, end_o2_pct, end_he_pct, false, false);

        if (result.status_code == 0) {
           result_txt = tmxcalc_text(filltype, start_bar, start_o2_pct, start_he_pct,
                result.mix_o2_pct, result.mix_he_pct, result.mix_n_pct,
                result.add_o2, result.add_he, result.add_air,
                result.tbar_3, 
                end_bar
            )
           $("#text_output").val(result_txt);
        }
        else {
            $("#text_output").val(result.status_txt);
        }

    }

  // this is called when any class input2 element changes
  $(function()
  {
      $(".input2").on("change",calculateBlend)
  })

  $("#ddl_ft").change(function () {

   dropval = $(this).val()
   console.log(`ddl_ft ${dropval} `);
   filltype = dropval;

   calculateBlend();
  });

</script>